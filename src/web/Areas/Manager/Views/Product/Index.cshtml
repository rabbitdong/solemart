@using Solemart.DataProvider.Entity;
@model List<ProductItem>

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Manager/Views/Shared/_ManagerLayout.cshtml";
}

<h1>查看货品列表:</h1>

<p class="search_area">
    <input type="text" id="prodct_name" />
    <input type="button" class="comm_btn" id="dosearch" value="搜索" />
</p>

@Html.Partial("_Pager")

<table class="m">
    <thead>
        <tr>
            <th>ID</th>
            <th>类别</th>
            <th>名称</th>
            <th>折扣</th>
            <th>特价</th>
            <th>上架价格</th>
            <th>规格</th>
            <th>说明</th>
            <th class="edit_th">编辑</th>
        </tr>
    </thead>
    <tbody>
        @if(Model!=null && Model.Count >0){
        foreach (ProductItem prod in Model) {
        <tr>
            <td>@prod.ProductID</td>
            <td>@prod.OwnedCategory.CateName</td>
            <td>@prod.Name</td>
            @if(prod.IsSaling){
            <td>@(prod.Discount+"%")</td>
            <td>@(prod.IsSpec?"是":"否")</td>
            <td>@(prod.SalePrice.ToString("C2"))</td>
            }else{
            <td>-</td>
            <td>-</td>
            <td>-</td>
            }
            <td><span class="prod_text ellipsis" title="@prod.Spec">@prod.Spec</span></td>
            <td><span class="prod_text ellipsis" title="@prod.Desc">@prod.Desc</span></td>
            <td>
                <a href="/Manager/Product/Modify/@prod.ProductID">修改</a>
                <a href="/Manager/Product/InStock/@prod.ProductID">入库</a>
                @if(prod.IsSaling){
                <a href="javascript:void(0);" onclick="modisaling(@prod.ProductID);">修改上架</a>
                <a href="javascript:void(0);" onclick="getbacksaling(@prod.ProductID)">下架</a>
                }else{
                <a href="javascript:void(0);" onclick="puttosaling(@prod.ProductID);">上架</a>
                }
            </td>
        </tr>
        }
        }else{
        <tr>
            <td colspan="6">没有商品</td>
        </tr>
        }
    </tbody>
</table>

<div id="edit_putto_saling">
    <h3>商品上架</h3>
    <fieldset>
        <ol>
            <li>
                <label for="putto_sale_pid">商品ID</label>
                <input type="text" id="putto_sale_pid" disabled="disabled" />
            </li>
            <li>
                <label for="putto_sale_discount">销售折扣</label>
                <input type="text" id="putto_sale_discount" value="100" />
                <p class="fNote">100表示不打折扣</p>
            </li>
            <li>
                <label for="putto_sale_price">销售定价</label>
                <input type="text" id="putto_sale_price" />
                <span>推荐定价:</span><span id="recommend_price"></span>
                <p class="fNote">实际的销售价格是本价格和折扣的乘积</p>
            </li>
            <li>
                <label for="putto_sale_specprice">是否特价</label>
                <input type="checkbox" id="putto_sale_specprice" />
            </li>
            <li>
                <label><a onclick="puttosaleok();" href="javascript:void(0);" class="comm_btn">确定</a></label>
            </li>
        </ol>
    </fieldset>
</div>

<script type="text/javascript">
    function puttosaling(pid) {
        $.post("/Manager/Product/GetLastStockPrice/" + pid, {},
            function (result) {
                $("#edit_putto_saling").css("display", "block");
                $("#edit_putto_saling #putto_sale_pid").val(pid);
                $("#edit_putto_saling #recommend_price").html(result);
            });
    }

    function modisaling(pid) {
        $.post("/Manager/Product/GetLastStockPrice/" + pid, {},
            function (result) {
                $("#edit_putto_saling").css("display", "block");
                $("#edit_putto_saling #putto_sale_pid").val(pid);
                $("#edit_putto_saling #recommend_price").html(result);
            });
    }

    function getbacksaling(pid) {
        $.post("/Manager/Product/GetBackSaling/" + pid, {},
            function (result) {
                if (result == "ok")
                    window.location.reload();
                else
                    alert(result);
            });
    }

    function puttosaleok() {
        $.post("/Manager/Product/PutToSaling/" + $("#putto_sale_pid").val(),
            {
                discount: $("#putto_sale_discount").val(),
                price: $("#putto_sale_price").val(),
                isspec: $("#putto_sale_specprice").is(":checked")
            },
            function (result) {
                if (result == "ok")
                    window.location.reload();
                else
                    alert(result);
            });
    }
</script>